<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Use Google Cloud Text-to-Speech to create an audio version of your blog posts | Bart de Goede</title>
<meta name="keywords" content="hugo, how-to, python, google cloud, podcast, blog, audio, text-to-speech">
<meta name="description" content="Audio is big. Like really big, and growing fast, to the tune of &#34;two-thirds of the population listens to online audio&#34; and &#34;weekly online listeners reporting an average nearly 17 hours of listening in the last week&#34;. These numbers include all kinds of audio, from online radio stations, audiobooks, streaming services and podcasts (hi Spotify!). It makes sense too. Consuming audio content is easier to consume and more engaging than written content while you&#39;re on the go, exercising, commuting or doing household chores. But what do you do if you&#39;re like me and don&#39;t have the time or recording equipment to ride this podcasting wave, and just write the occasional blog post?">
<meta name="author" content="Bart de Goede">
<link rel="canonical" href="https://bart.degoe.de/use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.410c1446ea708ec1ebe32059fa42c4acd4087fcd2634226ebfcf0ef5820b7739.css" integrity="sha256-QQwURupwjsHr4yBZ&#43;kLErNQIf80mNCJuv88O9YILdzk=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://bart.degoe.de/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://bart.degoe.de/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://bart.degoe.de/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://bart.degoe.de/apple-touch-icon.png">
<link rel="mask-icon" href="https://bart.degoe.de/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://bart.degoe.de/use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><link rel="search" href="/opensearch.xml" type="application/opensearchdescription+xml" title="Search bart.degoe.de">

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-6JBRP5YVDB"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-6JBRP5YVDB');
        }
      </script><meta property="og:url" content="https://bart.degoe.de/use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts/">
  <meta property="og:site_name" content="Bart de Goede">
  <meta property="og:title" content="Use Google Cloud Text-to-Speech to create an audio version of your blog posts">
  <meta property="og:description" content="Audio is big. Like really big, and growing fast, to the tune of &#34;two-thirds of the population listens to online audio&#34; and &#34;weekly online listeners reporting an average nearly 17 hours of listening in the last week&#34;. These numbers include all kinds of audio, from online radio stations, audiobooks, streaming services and podcasts (hi Spotify!). It makes sense too. Consuming audio content is easier to consume and more engaging than written content while you&#39;re on the go, exercising, commuting or doing household chores. But what do you do if you&#39;re like me and don&#39;t have the time or recording equipment to ride this podcasting wave, and just write the occasional blog post?">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2019-10-29T08:00:00-07:00">
    <meta property="article:modified_time" content="2019-10-29T08:00:00-07:00">
      <meta property="og:image" content="https://www.gravatar.com/avatar/af61db828941976309aaa8d7d76554fb">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://www.gravatar.com/avatar/af61db828941976309aaa8d7d76554fb">
<meta name="twitter:title" content="Use Google Cloud Text-to-Speech to create an audio version of your blog posts">
<meta name="twitter:description" content="Audio is big. Like really big, and growing fast, to the tune of &#34;two-thirds of the population listens to online audio&#34; and &#34;weekly online listeners reporting an average nearly 17 hours of listening in the last week&#34;. These numbers include all kinds of audio, from online radio stations, audiobooks, streaming services and podcasts (hi Spotify!). It makes sense too. Consuming audio content is easier to consume and more engaging than written content while you&#39;re on the go, exercising, commuting or doing household chores. But what do you do if you&#39;re like me and don&#39;t have the time or recording equipment to ride this podcasting wave, and just write the occasional blog post?">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://bart.degoe.de/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Use Google Cloud Text-to-Speech to create an audio version of your blog posts",
      "item": "https://bart.degoe.de/use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Use Google Cloud Text-to-Speech to create an audio version of your blog posts",
  "name": "Use Google Cloud Text-to-Speech to create an audio version of your blog posts",
  "description": "Audio is big. Like really big, and growing fast, to the tune of \"two-thirds of the population listens to online audio\" and \"weekly online listeners reporting an average nearly 17 hours of listening in the last week\". These numbers include all kinds of audio, from online radio stations, audiobooks, streaming services and podcasts (hi Spotify!). It makes sense too. Consuming audio content is easier to consume and more engaging than written content while you're on the go, exercising, commuting or doing household chores. But what do you do if you're like me and don't have the time or recording equipment to ride this podcasting wave, and just write the occasional blog post?",
  "keywords": [
    "hugo", "how-to", "python", "google cloud", "podcast", "blog", "audio", "text-to-speech"
  ],
  "articleBody": "Audio is big. Like, really big, and growing fast, to the tune of ‚Äútwo-thirds of the population listens to online audio‚Äù and ‚Äúweekly online listeners reporting an average nearly 17 hours of listening in the last week‚Äù1. These numbers include all kinds of audio, from online radio stations, audiobooks, streaming services and podcasts (hi Spotify!). It makes sense too. Consuming audio content is easier to consume and more engaging than written content while you‚Äôre on the go, exercising, commuting or doing household chores2. But what do you do if you‚Äôre like me and don‚Äôt have the time or recording equipment to ride this podcasting wave, and just write the occasional blog post?\nListen to this article instead Your browser does not support the audio element Well, you can always use a sophisticated deep learning text-to-speech model, train it on thousands of hours of audio content and endlessly tweak the model parameters, create an audio version of those occassional blog posts and host them on your website. Or, you know, you use the Google one3. The Cloud Text-to-Speech API is priced by character, and the first 1 million characters are free4! In this post, we‚Äôll go over how to set up a Google API, write a Python script to extract text from a Markdown file, and create a Hugo shortcode5 to include the generated files in your static website.\nSet up a Google API In order to get started, we have to jump through a couple of hoops to create a text-to-speech API. Most of these are pretty straightforward, and are easiest to follow when you‚Äôre signed in to your Google account. It will be even easier if you‚Äôve enabled billing which should be the default on a personal account (although you may have to add a payment method)6.\nThere's some steps you'll have to follow to set up an API. If you click that ‚ÄúEnable the API‚Äù button, you‚Äôll be taken to the project creation page. This project basically functions as a label and administrative container for everything ranging from authentication (API keys) to billing (so you can see what you spend on each Google product you‚Äôre using). Give it a name (leave ‚Äúorganization‚Äù set to ‚Äúno organization‚Äù).\nCreate a new Google Cloud project This will trigger some background jobs where Google will provision the resources necessary to run your very own text-to-speech API. Finally, we‚Äôll want to set up some authentication, so we can interact with this API. Create a service account for this project:\nCreate a service account for our text-to-speech project This will download a JSON file with API credentials to your computer. Do not throw away this file. You‚Äôll want to set the environment variable GOOGLE_APPLICATION_CREDENTIALS to the file path of this JSON file. Keep in mind that this will set the variable for the duration of your terminal session, so you‚Äôll have to set the variable again if you‚Äôre opening a new session.\n# in this case, the file was downloaded to my Downloads folder; you may want to put it elsewhere $ export GOOGLE_APPLICATION_CREDENTIALS=~/Downloads/text-to-speech-123456.json With all that, we can get started on our script to process some Markdown!\nWrite a script to transform text to audio I‚Äôm using Python for most of my scripting and hacking, so I‚Äôve got virtualenv set up on my machine; this essentially installs a Python interpreter for every project, so I can keep dependencies separated. For this project we have the following requirements; install them with pip install -r requirements.txt, or individually (i.e. pip install Click==7.0 etc.):\nbeautifulsoup4==4.8.1 Click==7.0 pydub==0.23.1 Markdown==3.1.1 google-cloud-texttospeech==0.5.0 Click is a great library for building CLI‚Äôs in Python, and besides giving us some nice features, it will make it easy to convert this script to some executable later on.\nWe‚Äôll be calling the script like this:\n$ python text_to_speech.py path/to/markdown.md The script will take the path to a Markdown file on disk, and do a couple of things to it:\nRead the file into memory Do some clean up, and convert it to plain text Send the text to our Google Cloud Text-to-Speech API, and write the audio from the response to disk Read file from disk # text_to_speech.py import click import logging import os logging.basicConfig(level=logging.INFO, format='%(asctime)s %(levelname)s %(message)s') @click.command() @click.argument('filename', type=click.File('rb')) def text_to_speech(filename): name = os.path.basename(filename.name).replace('.md', '') data = filename.read() if __name__ == '__main__': text_to_speech() This snippet defines a Click command, sets up logging, will try to open it‚Äôs argument as a file, stores the name of the file in a variable for later use, and reads and stores the contents of the file in a variable data. Step 1, check.\nConvert to plain text We need to send Google plain text as input for their model, so the next step is to add a function that will do some cleanup and extract the text from the Markdown-formatted file. In order to do that, we‚Äôll apply some regular expressions and convert the Markdown to HTML first, and use BeautifulSoup to extract the text.\n# text_to_speech.py import click import os import re from bs4 import BeautifulSoup from markdown import markdown def clean_text(text): # get rid of the Hugo preamble text = ''.join(text.decode('utf8').split('---')[2:]).strip() # get rid of superfluous newlines, as that counts towards our API limits text = re.sub('\\n+', ' ', text) # we're hacking our way around the markdown by converting to html first, # just because BeautifulSoup makes life so easy html = markdown(text) html = re.sub(r'(.*?)', ' ', html) # this removes some artifacts from Hugo shortcodes html = re.sub(r'{{}}', '', html) html = re.sub(r'\\[\\^.*?\\]', ' ', html) soup = BeautifulSoup(html, \"html.parser\") text = ''.join(soup.findAll(text=True)) # get rid of superfluous whitespace return re.sub(r'\\s+', ' ', text) @click.command() @click.argument('filename', type=click.File('rb')) def text_to_speech(filename): name = os.path.basename(filename.name).replace('.md', '') data = filename.read() text = clean_text(data) Now we extracted the plain text from our Markdown file, we can send it to Google:\nfrom google.cloud import texttospeech ... @click.command() @click.argument('filename', type=click.File('rb')) def text_to_speech(filename): name = os.path.basename(filename.name).replace('.md', '') data = filename.read() text = clean_text(data) text = clean_text(data) # initialize the API client client = texttospeech.TextToSpeechClient() # we can send up to 5000 characters per request, so split up the text step = 5000 for j, i in enumerate(range(0, len(text), step)): synthesis_input = texttospeech.types.SynthesisInput(text=text[i:i+step]) voice = texttospeech.types.VoiceSelectionParams( language_code='en-US', name='en-US-Wavenet-B' ) audio_config = texttospeech.types.AudioConfig( audio_encoding=texttospeech.enums.AudioEncoding.MP3 ) logging.info(f'Synthesizing speech for {name}_{j}') response = client.synthesize_speech(synthesis_input, voice, audio_config) with open(f'{name}_{j}.mp3', 'wb') as out: # Write the response to the output file. out.write(response.audio_content) logging.info(f'Audio content written to file \"{name}_{j}.mp3\"') Now, this is where we run into the first quirk of the API; it will only accept snippets of up to 5000 characters. My blog posts generally range between 12k to 15k characters, so I had to add some code that will chunk up the text into bits of 5000 characters each. Note that I don‚Äôt make any effort to detect word boundaries, so it can happen that a chunk will end with half a word; I‚Äôll leave it up to the reader to improve upon my implementation7.\nWe provide some configuration (I like the voice of robot es-US-Wavenet-B, but there are loads of other voices and languages to choose from), specify we want to receive an MP3 back, and write out the response MP3 into separate chunks in the current working directory.\nNext, we need to stitch the temporary MP3 chunks together (using the excellent pydub library), write the completed file to a sensible directory and clean up after ourselves.\nimport functools from glob import glob from pydub import AudioSegment ... mp3_segments = sorted(glob(f'{name}_*.mp3')) segments = [AudioSegment.from_mp3(f) for f in mp3_segments] logging.info(f'Stitching together {len(segments)} mp3 files for {name}') audio = functools.reduce(lambda a, b: a + b, segments) logging.info(f'Exporting {name}.mp3') audio.export(f'static/audio/{name}.mp3', format='mp3') logging.info(f'Exporting {name}.ogg') audio.export(f'static/audio/{name}.ogg', format='ogg') logging.info('Removing intermediate files') for f in mp3_segments: os.remove(f) This will stitch the MP38 segments together (functools.reduce), write out an MP3 and an OGG file (with the same filename as the blog post Markdown file) to the static/audio directory I use (change to a destination folder of your liking if necessary), and deletes the intermediate files from the current directory.\nYou can find the complete script here.\nRunning the script for this article generates output that looks like this:\n$ python scripts/text_to_speech.py content/post/2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts.md 2019-10-29 23:19:59,995 INFO Synthesizing speech for 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_0 2019-10-29 23:20:08,044 INFO Audio content written to file \"2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_0.mp3\" 2019-10-29 23:20:08,045 INFO Synthesizing speech for 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_1 2019-10-29 23:20:13,709 INFO Audio content written to file \"2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_1.mp3\" 2019-10-29 23:20:13,709 INFO Synthesizing speech for 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_2 2019-10-29 23:20:18,576 INFO Audio content written to file \"2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_2.mp3\" 2019-10-29 23:20:19,830 INFO Stitching together 3 mp3 files for 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts 2019-10-29 23:20:19,880 INFO Exporting 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts.mp3 2019-10-29 23:20:23,353 INFO Exporting 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts.ogg 2019-10-29 23:20:26,744 INFO Removing intermediate files Include audio in the post With this, we end up with a bunch of audio files a directory. In order to display them properly to our users so that they can actually consume the content, we have to do a little more work. Hugo provides shortcodes, which are effectively parameterized macro‚Äôs that expand into snippets of HTML that get embedded in your posts. There are many shortcodes included with standard Hugo (like figure, gist or tweet), but you can also create your own. We‚Äôll leverage that to include some swanky HTML5 audio tags in our blog posts9.\n\u003caudio controls class=\"audio_controls {{ .Get \"class\" }}\" {{ with .Get \"id\" }}id=\"{{ . }}\"{{ end }} {{ with .Get \"preload\" }}preload=\"{{ . }}\"{{ else }}preload=\"metadata\"{{ end }} style=\"{{ with .Get \"style\" }}{{ . | safeCSS }}; {{ end }}\" {{ with .Get \"title\" }}data-info-title=\"{{ . }}\"{{ end }} \u003e {{ if .Get \"src\" }} \u003csource {{ with .Get \"src\" }}src=\"{{ . }}\"{{ end }} {{ with .Get \"type\" }}type=\"audio/{{ . }}\"{{ end }}\u003e {{ else if .Get \"backup_src\" }} \u003csource src=\"{{ .Get \"backup_src\" }}\" {{ with .Get \"backup_type\" }}type=\"audio/{{ . }}\"{{ end }} {{ with .Get \"backup_codec\" }}codecs=\"{{ . }}\"{{ end }} \u003e {{ end }} Your browser does not support the audio element \u003c/audio\u003e This snippet will give us access to a shortcode that injects some HTML into our post, and accepts a couple of parameters so we can include the appropriate audio file, the appropriate backup file, and override styling should we so choose. This file should be stored in layouts/shortcodes/audio.html, and can be included in your posts as follows:\nLorem ipsum dolor sit amet. {{\u003caudio src=\"/audio/name-of-your-audio-file.mp3\" type=\"mp3\" backup_src=\"/audio/name-of-your-audio-file.ogg\" backup_type=\"ogg\"\u003e}} Some more words, this time not in Latin. This will include an audio player looking like this in your blog post. I‚Äôve added some bells and whistles to mine, with some additional styling for all the UX points.\nBasic HTML5 audio player https://www.edisonresearch.com/infinite-dial-2019/¬†‚Ü©Ô∏é\nNot to mention that audio content is more easily accessible for people that suffer from dyslexia or poor sight, or seems to be a lot better for user engagement.¬†‚Ü©Ô∏é\nIt has all kinds of funky stuff, like multiple languages, API clients in your favorite programming language, pitch, speaking rates and volume controls, and even optimizations around where your audio is going to play, such as headphones or phone lines.¬†‚Ü©Ô∏é\nFree is my favorite price.¬†‚Ü©Ô∏é\nMy website is a static website generated from Markdown files with Hugo, hosted on GitHub Pages, so you may need to make some small changes to make it work with Jekyll, Next.js or whichever other static site generator you‚Äôre using.¬†‚Ü©Ô∏é\nDon‚Äôt worry, the API is free for the first 4 million characters per month for standard voices, or 1 million characters for fancy WaveNet voices.¬†‚Ü©Ô∏é\nPull requests are always welcome! üòÑ¬†‚Ü©Ô∏é\npydub requires ffmpeg or libav to be installed to open, convert and save non-WAV files (such as MP3 or OGG)¬†‚Ü©Ô∏é\nNot all browsers support all file types and audio codecs, which is why we‚Äôve generated the OGG files as backup.¬†‚Ü©Ô∏é\n",
  "wordCount" : "1942",
  "inLanguage": "en",
  "image": "https://www.gravatar.com/avatar/af61db828941976309aaa8d7d76554fb","datePublished": "2019-10-29T08:00:00-07:00",
  "dateModified": "2019-10-29T08:00:00-07:00",
  "author":{
    "@type": "Person",
    "name": "Bart de Goede"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://bart.degoe.de/use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Bart de Goede",
    "logo": {
      "@type": "ImageObject",
      "url": "https://bart.degoe.de/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://bart.degoe.de/" accesskey="h" title="Bart de Goede (Alt + H)">Bart de Goede</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://bart.degoe.de/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://bart.degoe.de/">Home</a>&nbsp;¬ª&nbsp;<a href="https://bart.degoe.de/post/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Use Google Cloud Text-to-Speech to create an audio version of your blog posts
    </h1>
    <div class="post-description">
      Audio is big. Like really big, and growing fast, to the tune of &#34;two-thirds of the population listens to online audio&#34; and &#34;weekly online listeners reporting an average nearly 17 hours of listening in the last week&#34;. These numbers include all kinds of audio, from online radio stations, audiobooks, streaming services and podcasts (hi Spotify!). It makes sense too. Consuming audio content is easier to consume and more engaging than written content while you&#39;re on the go, exercising, commuting or doing household chores. But what do you do if you&#39;re like me and don&#39;t have the time or recording equipment to ride this podcasting wave, and just write the occasional blog post?
    </div>
    <div class="post-meta"><span title='2019-10-29 08:00:00 -0700 -0700'>October 29, 2019</span>&nbsp;¬∑&nbsp;<span>10 min</span>&nbsp;¬∑&nbsp;<span>Bart de Goede</span>

</div>
  </header> 
  <div class="post-content"><p><a href="https://www.edisonresearch.com/infinite-dial-2019/">Audio is big</a>. Like, really big, and growing fast, to the tune of &ldquo;two-thirds of the population listens to online audio&rdquo; and &ldquo;weekly online listeners reporting an average nearly 17 hours of listening in the last week&rdquo;<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. These numbers include all kinds of audio, from online radio stations, audiobooks, streaming services and podcasts (hi Spotify!). It makes sense too. Consuming audio content is easier to consume and more engaging than written content while you&rsquo;re on the go, exercising, commuting or doing household chores<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. But what do you do if you&rsquo;re like me and don&rsquo;t have the time or recording equipment to ride this podcasting wave, and just write the occasional blog post?<!-- more --></p>
<div id="player">
    <div class="listen">Listen to this article instead</div>
    <div id="waveform">
        
        <img src="https://bart.degoe.de/img/waveform.min.svg" alt="waveform">
    </div>
    <audio controls
        class="audio_controls "
        
        preload="metadata"

        style=""
        
    >
        
        <source src="/audio/2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts.mp3"
            type="audio/mp3">
        
        Your browser does not support the audio element
    </audio>
</div>

<p>Well, you can always use a sophisticated deep learning text-to-speech model, train it on thousands of hours of audio content and endlessly tweak the model parameters, create an audio version of those occassional blog posts and host them on your website. Or, you know, you use the <a href="https://cloud.google.com/text-to-speech/">Google one</a><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>. The Cloud Text-to-Speech API is priced by character, and the first 1 million characters are free<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>! In this post, we&rsquo;ll go over how to set up a Google API, write a Python script to extract text from a Markdown file, and create a Hugo shortcode<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> to include the generated files in your static website.</p>
<h1 id="set-up-a-google-api">Set up a Google API<a hidden class="anchor" aria-hidden="true" href="#set-up-a-google-api">#</a></h1>
<p>In order to get started, we have to jump through <a href="use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts">a couple of hoops</a> to create a text-to-speech API. Most of these are pretty straightforward, and are easiest to follow when you&rsquo;re signed in to your Google account. It will be even easier if you&rsquo;ve <a href="use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts">enabled billing</a> which should be the default on a personal account (although you may have to add a payment method)<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>.</p>
<figure>
    <img loading="lazy" src="/img/2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts/google-cloud-steps-to-get-started.png"/> <figcaption>
            There&#39;s some steps you&#39;ll have to follow to set up an API.
        </figcaption>
</figure>

<p>If you click that &ldquo;Enable the API&rdquo; button, you&rsquo;ll be taken to the project creation page. This project basically functions as a label and administrative container for everything ranging from authentication (API keys) to billing (so you can see what you spend on each Google product you&rsquo;re using). Give it a name (leave &ldquo;organization&rdquo; set to &ldquo;no organization&rdquo;).</p>
<figure>
    <img loading="lazy" src="/img/2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts/gcp-create-new-project.png"/> <figcaption>
            Create a new Google Cloud project
        </figcaption>
</figure>

<p>This will trigger some background jobs where Google will provision the resources necessary to run your very own text-to-speech API. Finally, we&rsquo;ll want to set up some authentication, so we can interact with this API. <a href="https://console.cloud.google.com/apis/credentials/serviceaccountkey">Create a service account</a> for this project:</p>
<figure>
    <img loading="lazy" src="/img/2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts/gcp-create-service-account.png"/> <figcaption>
            Create a service account for our text-to-speech project
        </figcaption>
</figure>

<p>This will download a JSON file with API credentials to your computer. <strong>Do not throw away this file.</strong> You&rsquo;ll want to set the environment variable <code>GOOGLE_APPLICATION_CREDENTIALS</code> to the file path of this JSON file. Keep in mind that this will set the variable for the duration of your terminal session, so you&rsquo;ll have to set the variable again if you&rsquo;re opening a new session.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># in this case, the file was downloaded to my Downloads folder; you may want to put it elsewhere</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">GOOGLE_APPLICATION_CREDENTIALS</span><span class="o">=</span>~/Downloads/text-to-speech-123456.json
</span></span></code></pre></div><p>With all that, we can get started on our script to process some Markdown!</p>
<h1 id="write-a-script-to-transform-text-to-audio">Write a script to transform text to audio<a hidden class="anchor" aria-hidden="true" href="#write-a-script-to-transform-text-to-audio">#</a></h1>
<p>I&rsquo;m using Python for most of my scripting and hacking, so I&rsquo;ve got <a href="https://docs.python-guide.org/dev/virtualenvs/"><code>virtualenv</code></a> set up on my machine; this essentially installs a Python interpreter for every project, so I can keep dependencies separated. For this project we have the following <a href="https://github.com/bartdegoede/blog/blob/master/requirements.txt">requirements</a>; install them with <code>pip install -r requirements.txt</code>, or individually (i.e. <code>pip install Click==7.0</code> etc.):</p>
<pre tabindex="0"><code>beautifulsoup4==4.8.1
Click==7.0
pydub==0.23.1
Markdown==3.1.1
google-cloud-texttospeech==0.5.0
</code></pre><p><a href="https://click.palletsprojects.com/en/7.x/">Click</a> is a great library for building CLI&rsquo;s in Python, and besides giving us some nice features, it will make it easy to convert this script to some executable later on.</p>
<p>We&rsquo;ll be calling the script like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python text_to_speech.py path/to/markdown.md
</span></span></code></pre></div><p>The script will take the path to a Markdown file on disk, and do a couple of things to it:</p>
<ol>
<li>Read the file into memory</li>
<li>Do some clean up, and convert it to plain text</li>
<li>Send the text to our Google Cloud Text-to-Speech API, and write the audio from the response to disk</li>
</ol>
<h2 id="read-file-from-disk">Read file from disk<a hidden class="anchor" aria-hidden="true" href="#read-file-from-disk">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># text_to_speech.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">click</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@click.command</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click.argument</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">text_to_speech</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.md&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">text_to_speech</span><span class="p">()</span>
</span></span></code></pre></div><p>This snippet defines a <code>Click</code> command, sets up logging, will try to open it&rsquo;s argument as a file, stores the name of the file in a variable for later use, and reads and stores the contents of the file in a variable <code>data</code>. Step 1, check.</p>
<h2 id="convert-to-plain-text">Convert to plain text<a hidden class="anchor" aria-hidden="true" href="#convert-to-plain-text">#</a></h2>
<p>We need to send Google plain text as input for their model, so the next step is to add a function that will do some cleanup and extract the text from the Markdown-formatted file. In order to do that, we&rsquo;ll apply some regular expressions and convert the Markdown to HTML first, and use <a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/">BeautifulSoup</a> to extract the text.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># text_to_speech.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">click</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">markdown</span> <span class="kn">import</span> <span class="n">markdown</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">clean_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># get rid of the Hugo preamble</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># get rid of superfluous newlines, as that counts towards our API limits</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># we&#39;re hacking our way around the markdown by converting to html first,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># just because BeautifulSoup makes life so easy</span>
</span></span><span class="line"><span class="cl">    <span class="n">html</span> <span class="o">=</span> <span class="n">markdown</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">html</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;pre&gt;(.*?)&lt;/pre&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># this removes some artifacts from Hugo shortcodes</span>
</span></span><span class="line"><span class="cl">    <span class="n">html</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;{{}}&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">html</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\[\^.*?\]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">&#34;html.parser&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># get rid of superfluous whitespace</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@click.command</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click.argument</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">text_to_speech</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.md&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">clean_text</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span></code></pre></div><p>Now we extracted the plain text from our Markdown file, we can send it to Google:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">texttospeech</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@click.command</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nd">@click.argument</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;rb&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">text_to_speech</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.md&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">clean_text</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">clean_text</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># initialize the API client</span>
</span></span><span class="line"><span class="cl">    <span class="n">client</span> <span class="o">=</span> <span class="n">texttospeech</span><span class="o">.</span><span class="n">TextToSpeechClient</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># we can send up to 5000 characters per request, so split up the text</span>
</span></span><span class="line"><span class="cl">    <span class="n">step</span> <span class="o">=</span> <span class="mi">5000</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">step</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="n">synthesis_input</span> <span class="o">=</span> <span class="n">texttospeech</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">SynthesisInput</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">step</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">voice</span> <span class="o">=</span> <span class="n">texttospeech</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">VoiceSelectionParams</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">language_code</span><span class="o">=</span><span class="s1">&#39;en-US&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;en-US-Wavenet-B&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">audio_config</span> <span class="o">=</span> <span class="n">texttospeech</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">AudioConfig</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">audio_encoding</span><span class="o">=</span><span class="n">texttospeech</span><span class="o">.</span><span class="n">enums</span><span class="o">.</span><span class="n">AudioEncoding</span><span class="o">.</span><span class="n">MP3</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Synthesizing speech for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">synthesize_speech</span><span class="p">(</span><span class="n">synthesis_input</span><span class="p">,</span> <span class="n">voice</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                            <span class="n">audio_config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">.mp3&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Write the response to the output file.</span>
</span></span><span class="line"><span class="cl">            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">audio_content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Audio content written to file &#34;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">.mp3&#34;&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>Now, this is where we run into the first quirk of the API; it will only accept snippets of up to 5000 characters. My blog posts generally range between 12k to 15k characters, so I had to add some code that will chunk up the text into bits of 5000 characters each. Note that I don&rsquo;t make any effort to detect word boundaries, so it can happen that a chunk will end with half a word; I&rsquo;ll leave it up to the reader to improve upon my implementation<sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>.</p>
<p>We provide some configuration (I like the voice of robot <code>es-US-Wavenet-B</code>, but there are <a href="https://cloud.google.com/text-to-speech/docs/voices">loads of other voices and languages to choose from</a>), specify we want to receive an MP3 back, and write out the response MP3 into separate chunks in the current working directory.</p>
<p>Next, we need to stitch the temporary MP3 chunks together (using the excellent <a href="https://github.com/jiaaro/pydub"><code>pydub</code> library</a>), write the completed file to a sensible directory and clean up after ourselves.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">functools</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pydub</span> <span class="kn">import</span> <span class="n">AudioSegment</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">mp3_segments</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_*.mp3&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">AudioSegment</span><span class="o">.</span><span class="n">from_mp3</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">mp3_segments</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Stitching together </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span><span class="si">}</span><span class="s1"> mp3 files for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">audio</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exporting </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.mp3&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">audio</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;static/audio/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.mp3&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;mp3&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exporting </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.ogg&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">audio</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;static/audio/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.ogg&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;ogg&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Removing intermediate files&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">mp3_segments</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span></code></pre></div><p>This will stitch the MP3<sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup> segments together (<code>functools.reduce</code>), write out an MP3 and an OGG file (with the same filename as the blog post Markdown file) to the <code>static/audio</code> directory I use (change to a destination folder of your liking if necessary), and deletes the intermediate files from the current directory.</p>
<p>You can find the complete script <a href="https://github.com/bartdegoede/blog/blob/master/scripts/text_to_speech.py">here</a>.</p>
<p>Running the script for this article generates output that looks like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python scripts/text_to_speech.py content/post/2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts.md
</span></span><span class="line"><span class="cl">2019-10-29 23:19:59,995 INFO Synthesizing speech <span class="k">for</span> 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_0
</span></span><span class="line"><span class="cl">2019-10-29 23:20:08,044 INFO Audio content written to file <span class="s2">&#34;2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_0.mp3&#34;</span>
</span></span><span class="line"><span class="cl">2019-10-29 23:20:08,045 INFO Synthesizing speech <span class="k">for</span> 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_1
</span></span><span class="line"><span class="cl">2019-10-29 23:20:13,709 INFO Audio content written to file <span class="s2">&#34;2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_1.mp3&#34;</span>
</span></span><span class="line"><span class="cl">2019-10-29 23:20:13,709 INFO Synthesizing speech <span class="k">for</span> 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_2
</span></span><span class="line"><span class="cl">2019-10-29 23:20:18,576 INFO Audio content written to file <span class="s2">&#34;2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts_2.mp3&#34;</span>
</span></span><span class="line"><span class="cl">2019-10-29 23:20:19,830 INFO Stitching together <span class="m">3</span> mp3 files <span class="k">for</span> 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts
</span></span><span class="line"><span class="cl">2019-10-29 23:20:19,880 INFO Exporting 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts.mp3
</span></span><span class="line"><span class="cl">2019-10-29 23:20:23,353 INFO Exporting 2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts.ogg
</span></span><span class="line"><span class="cl">2019-10-29 23:20:26,744 INFO Removing intermediate files
</span></span></code></pre></div><h1 id="include-audio-in-the-post">Include audio in the post<a hidden class="anchor" aria-hidden="true" href="#include-audio-in-the-post">#</a></h1>
<p>With this, we end up with a bunch of audio files a directory. In order to display them properly to our users so that they can actually consume the content, we have to do a little more work. <a href="https://gohugo.io/content-management/shortcodes/">Hugo provides <code>shortcodes</code></a>, which are effectively parameterized macro&rsquo;s that expand into snippets of HTML that get embedded in your posts. There are many shortcodes included with standard Hugo (like <code>figure</code>, <code>gist</code> or <code>tweet</code>), but you can also create your own. We&rsquo;ll leverage that to include <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio">some swanky HTML5 audio tags</a> in our blog posts<sup id="fnref:9"><a href="#fn:9" class="footnote-ref" role="doc-noteref">9</a></sup>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">audio</span> <span class="na">controls</span>
</span></span><span class="line"><span class="cl">    <span class="na">class</span><span class="o">=</span><span class="s">&#34;audio_controls {{ .Get &#34;</span><span class="na">class</span><span class="err">&#34;</span> <span class="err">}}&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="err">{{</span> <span class="na">with</span> <span class="err">.</span><span class="na">Get</span> <span class="err">&#34;</span><span class="na">id</span><span class="err">&#34;</span> <span class="err">}}</span><span class="na">id</span><span class="o">=</span><span class="s">&#34;{{ . }}&#34;</span><span class="err">{{</span> <span class="na">end</span> <span class="err">}}</span>
</span></span><span class="line"><span class="cl">    <span class="err">{{</span> <span class="na">with</span> <span class="err">.</span><span class="na">Get</span> <span class="err">&#34;</span><span class="na">preload</span><span class="err">&#34;</span> <span class="err">}}</span><span class="na">preload</span><span class="o">=</span><span class="s">&#34;{{ . }}&#34;</span><span class="err">{{</span> <span class="na">else</span> <span class="err">}}</span><span class="na">preload</span><span class="o">=</span><span class="s">&#34;metadata&#34;</span><span class="err">{{</span> <span class="na">end</span> <span class="err">}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="na">style</span><span class="o">=</span><span class="s">&#34;{{ with .Get &#34;</span><span class="na">style</span><span class="err">&#34;</span> <span class="err">}}{{</span> <span class="err">.</span> <span class="err">|</span> <span class="na">safeCSS</span> <span class="err">}};</span> <span class="err">{{</span> <span class="na">end</span> <span class="err">}}&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="err">{{</span> <span class="na">with</span> <span class="err">.</span><span class="na">Get</span> <span class="err">&#34;</span><span class="na">title</span><span class="err">&#34;</span> <span class="err">}}</span><span class="na">data-info-title</span><span class="o">=</span><span class="s">&#34;{{ . }}&#34;</span><span class="err">{{</span> <span class="na">end</span> <span class="err">}}</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {{ if .Get &#34;src&#34; }}
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">source</span> <span class="err">{{</span> <span class="na">with</span> <span class="err">.</span><span class="na">Get</span> <span class="err">&#34;</span><span class="na">src</span><span class="err">&#34;</span> <span class="err">}}</span><span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ . }}&#34;</span><span class="err">{{</span> <span class="na">end</span> <span class="err">}}</span>
</span></span><span class="line"><span class="cl">        <span class="err">{{</span> <span class="na">with</span> <span class="err">.</span><span class="na">Get</span> <span class="err">&#34;</span><span class="na">type</span><span class="err">&#34;</span> <span class="err">}}</span><span class="na">type</span><span class="o">=</span><span class="s">&#34;audio/{{ . }}&#34;</span><span class="err">{{</span> <span class="na">end</span> <span class="err">}}</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {{ else if .Get &#34;backup_src&#34; }}
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">source</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;{{ .Get &#34;</span><span class="na">backup_src</span><span class="err">&#34;</span> <span class="err">}}&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="err">{{</span> <span class="na">with</span> <span class="err">.</span><span class="na">Get</span> <span class="err">&#34;</span><span class="na">backup_type</span><span class="err">&#34;</span> <span class="err">}}</span><span class="na">type</span><span class="o">=</span><span class="s">&#34;audio/{{ . }}&#34;</span><span class="err">{{</span> <span class="na">end</span> <span class="err">}}</span>
</span></span><span class="line"><span class="cl">            <span class="err">{{</span> <span class="na">with</span> <span class="err">.</span><span class="na">Get</span> <span class="err">&#34;</span><span class="na">backup_codec</span><span class="err">&#34;</span> <span class="err">}}</span><span class="na">codecs</span><span class="o">=</span><span class="s">&#34;{{ . }}&#34;</span><span class="err">{{</span> <span class="na">end</span> <span class="err">}}</span>
</span></span><span class="line"><span class="cl">        <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    {{ end }}
</span></span><span class="line"><span class="cl">    Your browser does not support the audio element
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">audio</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>This snippet will give us access to a shortcode that injects some HTML into our post, and accepts a couple of parameters so we can include the appropriate audio file, the appropriate backup file, and override styling should we so choose. This file should be stored in <a href="https://github.com/bartdegoede/blog/blob/master/layouts/shortcodes/audio.html"><code>layouts/shortcodes/audio.html</code></a>, and can be included in your posts as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">Lorem ipsum dolor sit amet.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{{<span class="p">&lt;</span><span class="nt">audio</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;/audio/name-of-your-audio-file.mp3&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;mp3&#34;</span> <span class="na">backup_src</span><span class="o">=</span><span class="s">&#34;/audio/name-of-your-audio-file.ogg&#34;</span> <span class="na">backup_type</span><span class="o">=</span><span class="s">&#34;ogg&#34;</span><span class="p">&gt;</span>}}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Some more words, this time not in Latin.
</span></span></code></pre></div><p>This will include an audio player looking like this in your blog post. I&rsquo;ve added some <a href="https://github.com/bartdegoede/blog/blob/master/layouts/shortcodes/audio.html">bells and whistles to mine</a>, with <a href="https://github.com/bartdegoede/blog/commit/745e8ede74ee4d391fa16f648290210cc4296c61#diff-41d825e73cdbde165483f850749fb480">some additional styling</a> for all the UX points.</p>
<figure>
    <img loading="lazy" src="/img/2019-10-29-use-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts/audio-player.png"/> <figcaption>
            Basic HTML5 audio player
        </figcaption>
</figure>

<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><a href="https://www.edisonresearch.com/infinite-dial-2019/">https://www.edisonresearch.com/infinite-dial-2019/</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Not to mention that audio content is more easily accessible for people that suffer from dyslexia or poor sight, or seems to be a lot better for <a href="https://play.ht/blog/increasing-user-engagement-with-text-to-speech-case-study-by-play-ht/">user engagement</a>.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>It has all kinds of funky stuff, like multiple languages, API clients in your favorite programming language, pitch, speaking rates and volume controls, and even optimizations around where your audio is going to play, such as headphones or phone lines.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>Free is my favorite price.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>My website is a static website generated from Markdown files with <a href="https://gohugo.io/">Hugo</a>, hosted on <a href="https://pages.github.com/">GitHub Pages</a>, so you may need to make some small changes to make it work with <a href="https://jekyllrb.com/">Jekyll</a>, <a href="https://nextjs.org/">Next.js</a> or <a href="https://www.staticgen.com/">whichever other static site generator you&rsquo;re using</a>.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>Don&rsquo;t worry, the API is free for the first 4 million characters per month for standard voices, or 1 million characters for fancy WaveNet voices.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7">
<p><a href="https://github.com/bartdegoede/blog">Pull requests</a> are always welcome! üòÑ&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8">
<p><a href="https://github.com/jiaaro/pydub#dependencies"><code>pydub</code></a> requires <code>ffmpeg</code> or <code>libav</code> to be installed to open, convert and save non-WAV files (such as MP3 or OGG)&#160;<a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:9">
<p>Not all browsers support all file types and audio codecs, which is why we&rsquo;ve generated the OGG files as backup.&#160;<a href="#fnref:9" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Use Google Cloud Text-to-Speech to create an audio version of your blog posts on x"
            href="https://x.com/intent/tweet/?text=Use%20Google%20Cloud%20Text-to-Speech%20to%20create%20an%20audio%20version%20of%20your%20blog%20posts&amp;url=https%3a%2f%2fbart.degoe.de%2fuse-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Use Google Cloud Text-to-Speech to create an audio version of your blog posts on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fbart.degoe.de%2fuse-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts%2f&amp;title=Use%20Google%20Cloud%20Text-to-Speech%20to%20create%20an%20audio%20version%20of%20your%20blog%20posts&amp;summary=Use%20Google%20Cloud%20Text-to-Speech%20to%20create%20an%20audio%20version%20of%20your%20blog%20posts&amp;source=https%3a%2f%2fbart.degoe.de%2fuse-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Use Google Cloud Text-to-Speech to create an audio version of your blog posts on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fbart.degoe.de%2fuse-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts%2f&title=Use%20Google%20Cloud%20Text-to-Speech%20to%20create%20an%20audio%20version%20of%20your%20blog%20posts">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Use Google Cloud Text-to-Speech to create an audio version of your blog posts on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbart.degoe.de%2fuse-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Use Google Cloud Text-to-Speech to create an audio version of your blog posts on whatsapp"
            href="https://api.whatsapp.com/send?text=Use%20Google%20Cloud%20Text-to-Speech%20to%20create%20an%20audio%20version%20of%20your%20blog%20posts%20-%20https%3a%2f%2fbart.degoe.de%2fuse-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Use Google Cloud Text-to-Speech to create an audio version of your blog posts on telegram"
            href="https://telegram.me/share/url?text=Use%20Google%20Cloud%20Text-to-Speech%20to%20create%20an%20audio%20version%20of%20your%20blog%20posts&amp;url=https%3a%2f%2fbart.degoe.de%2fuse-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Use Google Cloud Text-to-Speech to create an audio version of your blog posts on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Use%20Google%20Cloud%20Text-to-Speech%20to%20create%20an%20audio%20version%20of%20your%20blog%20posts&u=https%3a%2f%2fbart.degoe.de%2fuse-google-cloud-text-to-speech-to-create-an-audio-version-of-your-blog-posts%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2025 <a href="https://bart.degoe.de/">Bart de Goede</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
